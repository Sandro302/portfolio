# Technology Stack — Engineering Calculation System

Описание используемого стека технологий по слоям системы.

---

## 1. Общий обзор

Система построена на основе многослойной архитектуры и использует сочетание:

- C++ — для высокопроизводительного расчётного ядра.
- Python — для REST API, оркестрации расчётов и вспомогательных сервисов.
- PostgreSQL — для хранения проектов, топологии, расчётов и результатов.
- Qt / Web (SPA) — для пользовательского интерфейса.
- PlantUML / Markdown / OpenAPI — для документации и диаграмм.

---

## 2. Client Layer (UI)

### Desktop UI

- **Технологии:** Qt (C++/Qt Widgets или Qt Quick).  
- **Назначение:**
  - Работа в средах, где нужен «толстый» клиент (инженерные рабочие станции).
  - Глубокая интеграция с файловой системой (работа с проектами OLGA).
  - Отрисовка схемы трубопровода и графиков локально.

### Web UI

- **Технологии:**  
  - Любой современный SPA‑фреймворк (React / Vue / Angular).  
- **Назначение:**
  - Доступ через браузер.
  - Просмотр проектов, статусов расчётов и результатов.
  - Возможность интеграции с другими веб‑системами компании.

Оба UI‑клиента работают через REST API, что позволяет развивать их независимо от backend’а.

---

## 3. API Layer

- **Язык:** Python.  
- **Фреймворк:** FastAPI / Flask (ориентир — FastAPI для удобства описания схем и интеграции с OpenAPI).  
- **Функции:**
  - Авторизация/аутентификация (интеграция с корпоративным Identity Provider — по необходимости).
  - Экспонирование REST API (`/projects`, `/import/olga`, `/calculations`, `/results`, `/export`).
  - Валидация входных данных.
  - Передача команд в сервисы приложения (Import/Calculation/Export).

- **Документация:**  
  - OpenAPI (файл `API_Spec.yaml`), доступная через встроенный Swagger UI или ReDoc.

---

## 4. Application Layer

### Import Service

- **Язык:** Python (можно как отдельный модуль/процесс).  
- **Функции:**
  - Приём и обработка файлов OLGA.
  - Вызов модуля парсинга.
  - Создание проекта, топологии, логов импорта.

### Calculation Service

- **Язык:** Python.  
- **Функции:**
  - Оркестрация выполнения расчётов.
  - Загрузка входных данных из БД.
  - Вызов Calculation Engine (C++).
  - Сохранение результатов.
  - Обновление статусов и оповещение Notification Service.

### Export Service

- **Язык:** Python.  
- **Функции:**
  - Формирование табличного представления результатов.
  - Генерация CSV/других форматов.
  - Возврат файла UI или сохранение в файловом хранилище.

### Notification Service

- **Язык:** Python / Node.js (по выбору).  
- **Функции:**
  - Управление подписками (WebSocket / webhook).
  - Push‑уведомления о статусах расчётов (started/completed/failed).

---

## 5. Domain / Engine Layer

### Calculation Engine (C++)

- **Язык:** C++.  
- **Назначение:**
  - Выполнение вычислений (гидродинамика, тепломассообмен и т.п.).
  - Работа с подготовленным входным набором (топология + параметры).
- **Интеграция:**
  - Через обёртку (Python bindings / gRPC / IPC).
  - Calculation Service создаёт структуру данных и передаёт её в движок.

### OLGA Parser

- **Язык:** C++/Python (в зависимости от существующей реализации).  
- **Функции:**
  - Разбор файлов формата OLGA.
  - Преобразование данных к внутренней модели (узлы, трубы, профили, параметры).

---

## 6. Data Layer

### PostgreSQL

- **Роль:** основное хранилище данных.  
- **Схема:** `engineering`.  
- **Основные сущности:**
  - PROJECTS, NODES, PIPES,
  - CALCULATIONS, CALCULATION_RESULTS,
  - TEMPLATES,
  - IMPORT_LOGS, ERROR_LOGS.

- **Особенности:**
  - Использование `uuid` для идентификаторов.
  - Использование `jsonb` для гибких параметров и дополнительной информации.
  - Индексы по ключевым полям (status, project_id, timestamps).
  - Триггеры для автоматического обновления `updated_at`.

---

## 7. Документация и моделирование

- **Диаграммы:** PlantUML
  - BPMN‑подобные процессы (импорт, расчёт, экспорт).
  - UML (Use Case, Sequence, Component).
  - ER‑диаграмма БД.

- **Спецификации:** Markdown + OpenAPI (YAML)
  - Requirements (Business, Functional, Non‑Functional).
  - Use Cases.
  - Technical Specification.
  - API_Spec.yaml.

- **Формат репозитория:**  
  - Всё хранится в виде текстовых артефактов (Markdown, .puml, .sql, .yaml), что упрощает версионирование в Git.

---

## 8. Инфраструктура и развёртывание (вариант)

- Контейнеризация сервисов (Docker):
  - API, Import/Calculation/Export/Notification services — отдельные контейнеры.
  - PostgreSQL — выделенный контейнер/managed instance.
- Оркестрация:
  - Docker Compose (dev/stage),
  - Kubernetes (prod) — по необходимости.
- Мониторинг и логирование:
  - Интеграция с существующими инструментами (Prometheus/Grafana, ELK, Loki и др. — в зависимости от инфраструктуры компании).

---

## 9. Обоснование выбора технологий

- **C++** — высокая производительность, существующее расчётное ядро/библиотеки.
- **Python (FastAPI)** — быстрый старт для REST API, хорошая интеграция с OpenAPI, простота написания вспомогательных сервисов.
- 
